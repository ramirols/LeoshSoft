---
import { getCollection } from "astro:content";
import BlogLayout from "../../../layouts/BlogLayout.astro";

export async function getStaticPaths() {
    const posts = await getCollection("blog");
    return posts.map((post) => ({
        params: { slug: post.id },
        props: { post },
    }));
}

const { post } = Astro.props;

const { Content } = await post.render();

const allPosts = await getCollection("blog");

const related = allPosts.filter((p) => p.id !== post.id).slice(0, 3);
---

<BlogLayout frontmatter={post.data}>
    <Content />

    <div slot="related">
        {
            related.map((r) => (
                <a
                    href={`/blog/${r.id}`}
                    class="group block border rounded-2xl overflow-hidden hover:shadow-lg transition"
                >
                    {r.data.cover && (
                        <img
                            src={r.data.cover}
                            alt={r.data.title}
                            class="h-40 w-full object-cover group-hover:scale-105 transition"
                        />
                    )}

                    <div class="p-5">
                        <h3 class="font-semibold text-lg leading-snug">
                            {r.data.title}
                        </h3>
                        <p class="text-sm text-gray-600 mt-2">
                            {r.data.description}
                        </p>
                    </div>
                </a>
            ))
        }
    </div>
</BlogLayout>
