---
import { getCollection } from "astro:content";
import BlogLayout from "../../layouts/BlogLayout.astro";

export async function getStaticPaths() {
    const posts = await getCollection("blog");
    return posts.map((post) => ({
        params: { slug: post.id },
        props: { post },
    }));
}

const { post } = Astro.props;

const { Content } = await post.render();

const allPosts = await getCollection("blog");

const related = allPosts.filter((p) => p.id !== post.id).slice(0, 3);
---

<BlogLayout frontmatter={post.data}>
    <Content />

    <div slot="related" class="grid sm:grid-cols-2 gap-6">
        {
            related.map((r) => (
                <a
                    href={`/blog/${r.id}`}
                    class="block p-5 border rounded-xl hover:bg-gray-50 transition"
                >
                    <h3 class="font-semibold text-lg">{r.data.title}</h3>
                    <p class="text-sm text-gray-600 mt-2">
                        {r.data.description}
                    </p>
                </a>
            ))
        }
    </div>
</BlogLayout>
